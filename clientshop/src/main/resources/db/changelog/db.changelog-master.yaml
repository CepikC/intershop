databaseChangeLog:
  - changeSet:
      id: 1
      author: serik
      changes:
        - createTable:
            tableName: items
            columns:
              - column:
                  name: id
                  type: BIGSERIAL
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              - column:
                  name: title
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
              - column:
                  name: price
                  type: NUMERIC(10,2)
                  constraints:
                    nullable: false
              - column:
                  name: description
                  type: VARCHAR(1000)
              - column:
                  name: img_path
                  type: VARCHAR(255)

        - createTable:
            tableName: orders
            columns:
              - column:
                  name: id
                  type: BIGSERIAL
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: total_sum
                  type: NUMERIC(10,2)
                  constraints:
                    nullable: false

        - createTable:
            tableName: order_items
            columns:
              - column:
                  name: id
                  type: BIGSERIAL
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              - column:
                  name: item_id
                  type: BIGINT
                  constraints:
                    nullable: false
                    foreignKeyName: fk_order_items_item
                    references: items(id)
              - column:
                  name: count
                  type: INT
                  constraints:
                    nullable: false
              - column:
                  name: price
                  type: NUMERIC(10,2)
                  constraints:
                    nullable: false
              - column:
                  name: order_id
                  type: BIGINT
                  constraints:
                    foreignKeyName: fk_order_items_order
                    references: orders(id)

  - changeSet:
      id: 2
      author: serik
      changes:
        - insert:
            tableName: items
            columns:
              - column:
                  name: title
                  value: "Apple iPhone 15 Pro"
              - column:
                  name: price
                  valueNumeric: 699990.00
              - column:
                  name: description
                  value: "Флагманский смартфон Apple с чипом A17 Pro"
              - column:
                  name: img_path
                  value: "second.png"

        - insert:
            tableName: items
            columns:
              - column:
                  name: title
                  value: "Samsung Galaxy S24"
              - column:
                  name: price
                  valueNumeric: 599990.00
              - column:
                  name: description
                  value: "Флагманский смартфон Samsung с AMOLED-дисплеем"
              - column:
                  name: img_path
                  value: "first.png"

        - insert:
            tableName: items
            columns:
              - column:
                  name: title
                  value: "Xiaomi Redmi Note 13"
              - column:
                  name: price
                  valueNumeric: 199990.00
              - column:
                  name: description
                  value: "Доступный смартфон Xiaomi с батареей на 5000 мАч"
              - column:
                  name: img_path
                  value: "second.png"

        - insert:
            tableName: items
            columns:
              - column:
                  name: title
                  value: "Samsung Galaxy S24 Ultra"
              - column:
                  name: price
                  valueNumeric: 649990.00
              - column:
                  name: description
                  value: "Топовый смартфон Samsung с камерой 200 МП"
              - column:
                  name: img_path
                  value: "first.png"

        - insert:
            tableName: items
            columns:
              - column:
                  name: title
                  value: "MacBook Pro 16 (M3 Max)"
              - column:
                  name: price
                  valueNumeric: 1249990.00
              - column:
                  name: description
                  value: "Профессиональный ноутбук Apple на чипе M3 Max"
              - column:
                  name: img_path
                  value: "second.png"

        - insert:
            tableName: items
            columns:
              - column:
                  name: title
                  value: "Sony PlayStation 5"
              - column:
                  name: price
                  valueNumeric: 299990.00
              - column:
                  name: description
                  value: "Игровая консоль нового поколения"
              - column:
                  name: img_path
                  value: "first.png"

        - insert:
            tableName: items
            columns:
              - column:
                  name: title
                  value: "Apple Watch Ultra 2"
              - column:
                  name: price
                  valueNumeric: 399990.00
              - column:
                  name: description
                  value: "Премиальные умные часы Apple"
              - column:
                  name: img_path
                  value: "second.png"

        - insert:
            tableName: items
            columns:
              - column:
                  name: title
                  value: "AirPods Pro 2"
              - column:
                  name: price
                  valueNumeric: 119990.00
              - column:
                  name: description
                  value: "Беспроводные наушники с шумоподавлением"
              - column:
                  name: img_path
                  value: "first.png"

        - insert:
            tableName: items
            columns:
              - column:
                  name: title
                  value: "Asus ROG Zephyrus G14"
              - column:
                  name: price
                  valueNumeric: 899990.00
              - column:
                  name: description
                  value: "Игровой ноутбук с RTX 4070"
              - column:
                  name: img_path
                  value: "second.png"

        - insert:
            tableName: items
            columns:
              - column:
                  name: title
                  value: "GoPro HERO12 Black"
              - column:
                  name: price
                  valueNumeric: 199990.00
              - column:
                  name: description
                  value: "Экшн-камера с улучшенной стабилизацией"
              - column:
                  name: img_path
                  value: "first.png"

        - insert:
            tableName: items
            columns:
              - column:
                  name: title
                  value: "Kindle Paperwhite 11"
              - column:
                  name: price
                  valueNumeric: 79990.00
              - column:
                  name: description
                  value: "Электронная книга с подсветкой"
              - column:
                  name: img_path
                  value: "second.png"

        - insert:
            tableName: items
            columns:
              - column:
                  name: title
                  value: "DJI Mini 4 Pro"
              - column:
                  name: price
                  valueNumeric: 499990.00
              - column:
                  name: description
                  value: "Компактный дрон с 4K-камерой"
              - column:
                  name: img_path
                  value: "first.png"
  - changeSet:
      id: 3
      author: serik
      preConditions:
        onFail: MARK_RAN
        not:
          tableExists:
            tableName: users
      changes:
        - createTable:
            tableName: users
            columns:
              - column:
                  name: id
                  type: BIGSERIAL
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              - column:
                  name: username
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
              - column:
                  name: password
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
              - column:
                  name: role
                  type: VARCHAR(255)
                  constraints:
                    nullable: false

        - insert:
            tableName: users
            columns:
              - column:
                  name: username
                  value: "1"
              - column:
                  name: password
                  value: "$2a$10$wXPY16G/JEgBmr83E993Pucpj83S1pNqw6uvnilWzYexYS2AtKDJi"
              - column:
                  name: role
                  value: "USER"

        - insert:
            tableName: users
            columns:
              - column:
                  name: username
                  value: "2"
              - column:
                  name: password
                  value: "$2a$10$A.s/ZPIkfcFJROxHwAYNbOQVGP1dMslrcFs5jWgtanyVJwTO3BWo2"
              - column:
                  name: role
                  value: "USER"

        - insert:
            tableName: users
            columns:
              - column:
                  name: username
                  value: "3"
              - column:
                  name: password
                  value: "$2a$10$awCB8M43mDaczrvW/SG17OlDYfD..uZy3IKy41eZjsZ.XOAj9CD9O"
              - column:
                  name: role
                  value: "USER"

  - changeSet:
      id: 4
      author: serik
      preConditions:
        onFail: MARK_RAN
        tableExists:
          tableName: orders
      changes:
        - addColumn:
            tableName: orders
            columns:
              - column:
                  name: user_id
                  type: BIGINT
